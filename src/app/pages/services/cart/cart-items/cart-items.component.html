<div class="cart-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center py-8">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
  </div>

  <!-- Cart Content -->
  <div *ngIf="!isLoading" class="space-y-4">
    <!-- Empty Cart Message -->
    <div *ngIf="cartProducts.length === 0" class="text-center py-8">
      <p class="text-gray-500">Tu carrito está vacío</p>
    </div>

    <!-- Cart Items -->
    <div *ngFor="let product of cartProducts"
         class="flex items-center justify-between p-4 border rounded-lg shadow-sm hover:shadow-md transition-shadow"
         [class.opacity-75]="product.updating">

    <!-- Product Image Container -->
      <div class="relative w-16 h-16 flex-shrink-0">
        <!-- Loading Spinner -->
        <div *ngIf="!product.imageLoaded && !product.imageError"
             class="absolute inset-0 flex items-center justify-center bg-gray-100 rounded-md">
          <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"></div>
        </div>

        <!-- Product Image -->
        <img [src]="product.imageUrl"
             [alt]="product.name"
             class="w-16 h-16 object-cover rounded-md transition-opacity duration-300"
             [ngClass]="{
               'opacity-0': !product.imageLoaded && !product.imageError,
               'opacity-100': product.imageLoaded || product.imageError
             }"
             (load)="onImageLoad(product)"
             (error)="onImageError(product)">
      </div>

      <!-- Product Details -->
      <div class="flex-grow ml-4">
        <h3 class="font-semibold text-gray-800">{{product.name}}</h3>
        <p class="text-sm text-gray-600">SKU: {{product.skuCode}}</p>
        <p class="text-green-600 font-medium">{{product.price | currency:'USD'}}</p>
      </div>

      <!-- Quantity Controls -->
      <div class="flex items-center space-x-2">
        <button
          (click)="handleQuantityChange(product, product.quantity - 1)"
          [disabled]="product.updating"
          class="w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 disabled:opacity-50 flex items-center justify-center">
          -
        </button>

        <span class="w-8 text-center">{{product.quantity}}</span>

        <button
          (click)="handleQuantityChange(product, product.quantity + 1)"
          [disabled]="product.updating"
          class="w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 disabled:opacity-50 flex items-center justify-center">
          +
        </button>
      </div>

      <!-- Remove Button -->
      <button
        (click)="onRemoveItem(product.id)"
        class="ml-4 text-red-500 hover:text-red-700"
        [disabled]="product.updating">
        <i class="fas fa-trash"></i>
      </button>
    </div>

    <!-- Error Messages -->
    <div *ngFor="let product of cartProducts">
      <div *ngIf="product.error"
           class="text-red-500 text-sm mt-1 bg-red-50 p-2 rounded">
        {{product.error}}
      </div>
    </div>

    <!-- Total and Next Step -->
    <div class="mt-6 space-y-4">
      <div class="flex justify-between items-center border-t pt-4">
        <span class="font-semibold text-lg">Total:</span>
        <span class="text-lg text-green-600 font-bold">
          {{calculateTotal() | currency:'USD'}}
        </span>
      </div>

      <button
        (click)="onNextStep()"
        [disabled]="hasUpdatingItems() || cartProducts.length === 0"
        class="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed">
        Continuar con el pago
      </button>
    </div>
  </div>
</div>
